<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(to right, #6a11cb, #2575fc);
    color: #fff;
    margin: 0;
    padding: 20px;
}
h1 { text-align: center; text-shadow: 1px 1px 6px rgba(0,0,0,0.4); }
h2 { margin-top: 40px; text-shadow: 1px 1px 4px rgba(0,0,0,0.3); }

.container {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 30px;
}
.card {
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    padding: 20px;
    border-radius: 15px;
    text-align: center;
    width: 200px;
    transition: transform 0.3s, box-shadow 0.3s;
    cursor: pointer;
    box-shadow: 0 6px 12px rgba(0,0,0,0.2);
}
.card:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 12px 25px rgba(0,0,0,0.4);
}

table {
    width: 90%;
    max-width: 1000px;
    margin: 20px auto;
    border-collapse: collapse;
    background: rgba(255,255,255,0.1);
    border-radius: 10px;
    overflow: hidden;
}
th, td {
    padding: 12px;
    text-align: center;
}
th {
    background: rgba(255,255,255,0.2);
}
tbody tr:nth-child(even) { background: rgba(255,255,255,0.05); }
tbody tr:hover { background: rgba(255,255,255,0.15); }
caption {
    caption-side: top;
    font-size: 22px;
    margin-bottom: 10px;
    font-weight: bold;
    color: #fff;
}

a.logout {
    display: block;
    text-align: center;
    color: white;
    text-decoration: underline;
    margin-top: 20px;
    transition: color 0.3s;
}
a.logout:hover { color: #ffeb3b; }

.collapsible {
    background: rgba(255,255,255,0.2);
    cursor: pointer;
    padding: 12px;
    width: 90%;
    margin: 10px auto;
    border: none;
    text-align: left;
    outline: none;
    font-size: 18px;
    border-radius: 8px;
    transition: background 0.3s;
}
.collapsible:hover { background: rgba(255,255,255,0.35); }
.content {
    padding: 0 15px;
    display: none;
    overflow: hidden;
}
</style>
</head>
<body>

<h1>Admin Dashboard</h1>

<div class="container">
    <a class="card" href="/create_event_form">Create Event</a>
    <a class="card" href="/register_college_form">Register College</a>
    <a class="card" href="/admin/attendance_requests">Attendance Requests</a>
</div>


<!-- Summary Boxes -->
<div class="container">
    <div class="card" id="total-colleges">Colleges: 0</div>
    <div class="card" id="total-events">Events: 0</div>
    <div class="card" id="total-students">Students: 0</div>
</div>

<!-- Collapsible Tables -->
<button class="collapsible">Colleges</button>
<div class="content">
    <table id="colleges-table">
        <thead><tr><th>ID</th><th>Name</th></tr></thead>
        <tbody></tbody>
    </table>
</div>

<button class="collapsible">Events</button>
<div class="content">
    <table id="events-table">
        <thead><tr><th>ID</th><th>Name</th><th>Type</th><th>Date</th></tr></thead>
        <tbody></tbody>
    </table>
</div>

<button class="collapsible">Students</button>
<div class="content">
    <table id="students-table">
        <thead><tr><th>ID</th><th>Name</th><th>Email</th></tr></thead>
        <tbody></tbody>
    </table>
</div>

<button class="collapsible">Registrations per Event</button>
<div class="content">
    <table id="registrations-event-table">
        <thead><tr><th>Event ID</th><th>Name</th><th>Registrations</th></tr></thead>
        <tbody></tbody>
    </table>
</div>

<button class="collapsible">Top 3 Active Students</button>
<div class="content">
    <table id="top-students-table">
        <thead><tr><th>ID</th><th>Name</th><th>Registrations</th></tr></thead>
        <tbody></tbody>
    </table>
</div>

<a href="/admin/logout" class="logout">Logout</a>

<script>
// Collapsible Sections
const coll = document.getElementsByClassName("collapsible");
for (let i=0; i<coll.length; i++) {
    coll[i].addEventListener("click", function() {
        this.classList.toggle("active");
        const content = this.nextElementSibling;
        content.style.display = (content.style.display === "block") ? "none" : "block";
    });
}

// Fetch and populate dashboard data
async function fetchDashboard() {
    try {
        const resp = await fetch('/admin/dashboard_data');
        const data = await resp.json();

        // Update summary cards
        document.getElementById('total-colleges').innerText = `Colleges: ${data.colleges.length}`;
        document.getElementById('total-events').innerText = `Events: ${data.events.length}`;
        document.getElementById('total-students').innerText = `Students: ${data.students.length}`;

        // Populate Colleges Table
        const collegesTbody = document.querySelector("#colleges-table tbody");
        data.colleges.forEach(c => { 
            const tr = document.createElement("tr"); 
            tr.innerHTML = `<td>${c.id}</td><td>${c.name}</td>`; 
            collegesTbody.appendChild(tr); 
        });

        // Populate Events Table
        const eventsTbody = document.querySelector("#events-table tbody");
        data.events.forEach(e => { 
            const tr = document.createElement("tr"); 
            tr.innerHTML = `<td>${e.id}</td><td>${e.name}</td><td>${e.event_type || ''}</td><td>${e.date}</td>`; 
            eventsTbody.appendChild(tr); 
        });

        // Populate Students Table
        const studentsTbody = document.querySelector("#students-table tbody");
        data.students.forEach(s => { 
            const tr = document.createElement("tr"); 
            tr.innerHTML = `<td>${s.id}</td><td>${s.username}</td><td>${s.email}</td>`; 
            studentsTbody.appendChild(tr); 
        });

        // Registrations per Event
        const regTbody = document.querySelector("#registrations-event-table tbody");
        data.registrations_per_event.forEach(r => {
            const tr = document.createElement("tr");
            tr.innerHTML = `<td>${r.event_id}</td><td>${r.event_name}</td><td>${r.count}</td>`;
            regTbody.appendChild(tr);
        });

        // Top 3 Active Students
        const topTbody = document.querySelector("#top-students-table tbody");
        data.top_students.forEach(s => {
            const tr = document.createElement("tr");
            tr.innerHTML = `<td>${s.student_id}</td><td>${s.student_name}</td><td>${s.registrations}</td>`;
            topTbody.appendChild(tr);
        });

    } catch(err) {
        console.error("Error fetching dashboard:", err);
    }
}

fetchDashboard();
</script>

</body>
</html>
